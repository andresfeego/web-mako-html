var Canvas2Image=function(){var t=!1,r=document.createElement("canvas");if(r.getContext("2d")&&(t=!0),!t)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var a=!!r.getContext("2d").getImageData,e=!!r.toDataURL,h=!!window.btoa,n="image/octet-stream",o=function(t){var r=parseInt(t.width),a=parseInt(t.height);return t.getContext("2d").getImageData(0,0,r,a)},u=function(t){var r="";if("string"==typeof t)r=t;else for(var a=t,e=0;e<a.length;e++)r+=String.fromCharCode(a[e]);return btoa(r)},s=function(t){var r=[],a=t.width,e=t.height;r.push(66),r.push(77);var h=a*e*3+54;r.push(h%256),h=Math.floor(h/256),r.push(h%256),h=Math.floor(h/256),r.push(h%256),h=Math.floor(h/256),r.push(h%256),r.push(0),r.push(0),r.push(0),r.push(0),r.push(54),r.push(0),r.push(0),r.push(0);var n=[];n.push(40),n.push(0),n.push(0),n.push(0);var o=a;n.push(o%256),o=Math.floor(o/256),n.push(o%256),o=Math.floor(o/256),n.push(o%256),o=Math.floor(o/256),n.push(o%256);var s=e;n.push(s%256),s=Math.floor(s/256),n.push(s%256),s=Math.floor(s/256),n.push(s%256),s=Math.floor(s/256),n.push(s%256),n.push(1),n.push(0),n.push(24),n.push(0),n.push(0),n.push(0),n.push(0),n.push(0);var p=a*e*3;n.push(p%256),p=Math.floor(p/256),n.push(p%256),p=Math.floor(p/256),n.push(p%256),p=Math.floor(p/256),n.push(p%256);for(var i=0;16>i;i++)n.push(0);var f=(4-3*a%4)%4,v=t.data,g="",c=e;do{for(var d=a*(c-1)*4,m="",l=0;a>l;l++){var C=4*l;m+=String.fromCharCode(v[d+C+2]),m+=String.fromCharCode(v[d+C+1]),m+=String.fromCharCode(v[d+C])}for(var M=0;f>M;M++)m+=String.fromCharCode(0);g+=m}while(--c);var w=u(r.concat(n))+u(g);return w},p=function(t){document.location.href=t},i=function(t,r){return"data:"+r+";base64,"+t},f=function(t){var r=document.createElement("img");return r.src=t,r},v=function(t,r,a){if(r&&a){r=300,a=300;var e=document.createElement("canvas");e.width=r,e.height=a,e.style.width="200px",e.style.height="200px";var h=e.getContext("2d");return h.drawImage(t,0,0,t.width,t.height,0,0,r,a),e}return t};return{saveAsPNG:function(t,r,a,h){if(a=300,h=300,!e)return!1;var o=v(t,a,h),u=o.toDataURL("image/png");return r?f(u):(p(u.replace("image/png",n)),!0)},saveAsJPEG:function(t,r,a,h){if(!e)return!1;var o=v(t,a,h),u="image/jpeg",s=o.toDataURL(u);return 5!=s.indexOf(u)?!1:r?f(s):(p(s.replace(u,n)),!0)},saveAsBMP:function(t,r,e,u){if(!a||!h)return!1;var g=v(t,e,u),c=o(g),d=s(c);return r?f(i(d,"image/bmp")):(p(i(d,n)),!0)}}}();